<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>TanStack Router scrollRestoration æ·±åº¦è§£æï¼šä»æºç åˆ°å®ç°åŸç† | Baduncle Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="åœ¨ç°ä»£å•é¡µåº”ç”¨ï¼ˆSPAï¼‰å¼€å‘ä¸­ï¼Œç”¨æˆ·ä½“éªŒçš„ä¼˜åŒ–å¾€å¾€ä½“ç°åœ¨ç»†èŠ‚å¤„ç†ä¸Šã€‚å…¶ä¸­ï¼Œæ»šåŠ¨ä½ç½®çš„æ¢å¤åŠŸèƒ½æ˜¯ä¸€ä¸ªçœ‹ä¼¼ç®€å•ä½†æŠ€æœ¯å«é‡å¾ˆé«˜çš„ç‰¹æ€§ã€‚æœ¬æ–‡å°†æ·±å…¥åˆ†æ TanStack Router ä¸­ scrollRestoration åŠŸèƒ½çš„å®ç°åŸç†ï¼Œä»åŸºæœ¬æ¦‚å¿µåˆ°æºç è§£æï¼Œå…¨é¢è§£è¯»è¿™ä¸€é‡è¦ç‰¹æ€§ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="TanStack Router scrollRestoration æ·±åº¦è§£æï¼šä»æºç åˆ°å®ç°åŸç†">
<meta property="og:url" content="https://blog.baduncle.top/2025/08/06/tanstack-router-scroll-restoration-analysis/index.html">
<meta property="og:site_name" content="Baduncle Blog">
<meta property="og:description" content="åœ¨ç°ä»£å•é¡µåº”ç”¨ï¼ˆSPAï¼‰å¼€å‘ä¸­ï¼Œç”¨æˆ·ä½“éªŒçš„ä¼˜åŒ–å¾€å¾€ä½“ç°åœ¨ç»†èŠ‚å¤„ç†ä¸Šã€‚å…¶ä¸­ï¼Œæ»šåŠ¨ä½ç½®çš„æ¢å¤åŠŸèƒ½æ˜¯ä¸€ä¸ªçœ‹ä¼¼ç®€å•ä½†æŠ€æœ¯å«é‡å¾ˆé«˜çš„ç‰¹æ€§ã€‚æœ¬æ–‡å°†æ·±å…¥åˆ†æ TanStack Router ä¸­ scrollRestoration åŠŸèƒ½çš„å®ç°åŸç†ï¼Œä»åŸºæœ¬æ¦‚å¿µåˆ°æºç è§£æï¼Œå…¨é¢è§£è¯»è¿™ä¸€é‡è¦ç‰¹æ€§ã€‚">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-08-06T11:48:00.000Z">
<meta property="article:modified_time" content="2025-08-06T16:41:17.725Z">
<meta property="article:author" content="Baduncle">
<meta property="article:tag" content="tanstack-router">
<meta property="article:tag" content="react">
<meta property="article:tag" content="typescript">
<meta property="article:tag" content="spa">
<meta property="article:tag" content="scroll-restoration">
<meta property="article:tag" content="source-code-analysis">
<meta property="article:tag" content="session-storage">
<meta property="article:tag" content="browser-api">
<meta property="article:tag" content="history-api">
<meta property="article:tag" content="performance-optimization">
<meta property="article:tag" content="user-experience">
<meta property="article:tag" content="event-throttling">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Baduncle Blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Baduncle Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">vibe coding</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://blog.baduncle.top"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-tanstack-router-scroll-restoration-analysis" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/08/06/tanstack-router-scroll-restoration-analysis/" class="article-date">
  <time class="dt-published" datetime="2025-08-06T11:48:00.000Z" itemprop="datePublished">2025-08-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming/">Programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      TanStack Router scrollRestoration æ·±åº¦è§£æï¼šä»æºç åˆ°å®ç°åŸç†
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>åœ¨ç°ä»£å•é¡µåº”ç”¨ï¼ˆSPAï¼‰å¼€å‘ä¸­ï¼Œç”¨æˆ·ä½“éªŒçš„ä¼˜åŒ–å¾€å¾€ä½“ç°åœ¨ç»†èŠ‚å¤„ç†ä¸Šã€‚å…¶ä¸­ï¼Œæ»šåŠ¨ä½ç½®çš„æ¢å¤åŠŸèƒ½æ˜¯ä¸€ä¸ªçœ‹ä¼¼ç®€å•ä½†æŠ€æœ¯å«é‡å¾ˆé«˜çš„ç‰¹æ€§ã€‚æœ¬æ–‡å°†æ·±å…¥åˆ†æ TanStack Router ä¸­ <code>scrollRestoration</code> åŠŸèƒ½çš„å®ç°åŸç†ï¼Œä»åŸºæœ¬æ¦‚å¿µåˆ°æºç è§£æï¼Œå…¨é¢è§£è¯»è¿™ä¸€é‡è¦ç‰¹æ€§ã€‚</p>
<span id="more"></span>

<h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><ul>
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF-scrollRestoration%EF%BC%9F">ä»€ä¹ˆæ˜¯ scrollRestorationï¼Ÿ</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%E4%B8%BE%E4%BE%8B">ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹</a><ul>
<li><a href="#%E7%94%B5%E5%95%86%E7%BD%91%E7%AB%99%E5%9C%BA%E6%99%AF">ç”µå•†ç½‘ç«™åœºæ™¯</a></li>
<li><a href="#%E5%85%B6%E4%BB%96%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF">å…¶ä»–åº”ç”¨åœºæ™¯</a></li>
</ul>
</li>
<li><a href="#%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE%E5%92%8C%E4%BD%BF%E7%94%A8">åŸºæœ¬é…ç½®å’Œä½¿ç”¨</a></li>
<li><a href="#%E6%8A%80%E6%9C%AF%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86">æŠ€æœ¯å®ç°åŸç†</a></li>
<li><a href="#%E6%BA%90%E7%A0%81%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90">æºç æ·±åº¦è§£æ</a></li>
<li><a href="#%E6%BB%9A%E5%8A%A8%E6%81%A2%E5%A4%8D%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B">æ»šåŠ¨æ¢å¤å·¥ä½œæµç¨‹</a></li>
<li><a href="#%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7">é«˜çº§ç‰¹æ€§</a></li>
<li><a href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E6%9C%BA%E5%88%B6">æ€§èƒ½ä¼˜åŒ–æœºåˆ¶</a></li>
<li><a href="#%E8%BE%B9%E7%95%8C%E6%83%85%E5%86%B5%E5%A4%84%E7%90%86">è¾¹ç•Œæƒ…å†µå¤„ç†</a></li>
<li><a href="#%E6%80%BB%E7%BB%93">æ€»ç»“</a></li>
</ul>
<h2 id="ä»€ä¹ˆæ˜¯-scrollRestorationï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-scrollRestorationï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ scrollRestorationï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ scrollRestorationï¼Ÿ</h2><p><code>scrollRestoration</code> æ˜¯ TanStack Router æä¾›çš„ä¸€ä¸ªé…ç½®é€‰é¡¹ï¼Œå®ƒæ§åˆ¶é¡µé¢æ»šåŠ¨ä½ç½®çš„æ¢å¤è¡Œä¸ºã€‚å½“è®¾ç½®ä¸º <code>true</code> æ—¶ï¼Œå®ƒä¼šï¼š</p>
<ul>
<li><strong>è‡ªåŠ¨ä¿å­˜æ»šåŠ¨ä½ç½®</strong>ï¼šå½“ç”¨æˆ·ç¦»å¼€é¡µé¢æ—¶ï¼Œä¿å­˜å½“å‰çš„æ»šåŠ¨ä½ç½®</li>
<li><strong>è‡ªåŠ¨æ¢å¤æ»šåŠ¨ä½ç½®</strong>ï¼šå½“ç”¨æˆ·è¿”å›é¡µé¢æ—¶ï¼Œæ¢å¤åˆ°ä¹‹å‰çš„æ»šåŠ¨ä½ç½®</li>
<li><strong>æå‡ç”¨æˆ·ä½“éªŒ</strong>ï¼šé¿å…ç”¨æˆ·åœ¨å¯¼èˆªåéœ€è¦é‡æ–°æ»šåŠ¨åˆ°ä¹‹å‰æµè§ˆçš„ä½ç½®</li>
</ul>
<h2 id="ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹"><a href="#ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹" class="headerlink" title="ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹"></a>ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹</h2><h3 id="ç”µå•†ç½‘ç«™åœºæ™¯"><a href="#ç”µå•†ç½‘ç«™åœºæ™¯" class="headerlink" title="ç”µå•†ç½‘ç«™åœºæ™¯"></a>ç”µå•†ç½‘ç«™åœºæ™¯</h3><p>å‡è®¾ç”¨æˆ·åœ¨å•†å“åˆ—è¡¨é¡µæµè§ˆï¼š</p>
<p><strong>æ²¡æœ‰ scrollRestoration çš„æƒ…å†µ</strong>ï¼š</p>
<ol>
<li>ç”¨æˆ·æ»šåŠ¨åˆ°ç¬¬ 50 ä¸ªå•†å“ä½ç½®</li>
<li>ç‚¹å‡»æŸä¸ªå•†å“è¿›å…¥è¯¦æƒ…é¡µ</li>
<li>ç‚¹å‡»æµè§ˆå™¨åé€€æŒ‰é’®è¿”å›åˆ—è¡¨é¡µ</li>
<li>é¡µé¢å›åˆ°é¡¶éƒ¨ï¼Œç”¨æˆ·éœ€è¦é‡æ–°æ»šåŠ¨æ‰¾åˆ°ç¬¬ 50 ä¸ªå•†å“ ğŸ˜«</li>
</ol>
<p><strong>å¯ç”¨ scrollRestoration çš„æƒ…å†µ</strong>ï¼š</p>
<ol>
<li>ç”¨æˆ·æ»šåŠ¨åˆ°ç¬¬ 50 ä¸ªå•†å“ä½ç½®</li>
<li>ç‚¹å‡»æŸä¸ªå•†å“è¿›å…¥è¯¦æƒ…é¡µ</li>
<li>ç‚¹å‡»æµè§ˆå™¨åé€€æŒ‰é’®è¿”å›åˆ—è¡¨é¡µ</li>
<li>é¡µé¢è‡ªåŠ¨æ»šåŠ¨åˆ°ç¬¬ 50 ä¸ªå•†å“ä½ç½® ğŸ˜Š</li>
</ol>
<h3 id="å…¶ä»–åº”ç”¨åœºæ™¯"><a href="#å…¶ä»–åº”ç”¨åœºæ™¯" class="headerlink" title="å…¶ä»–åº”ç”¨åœºæ™¯"></a>å…¶ä»–åº”ç”¨åœºæ™¯</h3><ul>
<li><strong>ç¤¾äº¤åª’ä½“ Feed</strong>ï¼šæ»šåŠ¨åˆ°ç¬¬ 100 æ¡åŠ¨æ€ï¼Œç‚¹å‡»è¯„è®ºåè¿”å›ï¼Œè¿˜åœ¨ç¬¬ 100 æ¡çš„ä½ç½®</li>
<li><strong>æ–‡æ¡£é˜…è¯»</strong>ï¼šåœ¨é•¿æ–‡æ¡£ä¸­é—´ä½ç½®ï¼Œç‚¹å‡»é“¾æ¥åè¿”å›ï¼Œè¿˜åœ¨åŸæ¥çš„é˜…è¯»ä½ç½®</li>
<li><strong>æœç´¢ç»“æœ</strong>ï¼šæŸ¥çœ‹ç¬¬ 3 é¡µæœç´¢ç»“æœä¸­çš„æŸé¡¹ï¼Œè¿”å›åè¿˜åœ¨ç¬¬ 3 é¡µ</li>
</ul>
<h2 id="åŸºæœ¬é…ç½®å’Œä½¿ç”¨"><a href="#åŸºæœ¬é…ç½®å’Œä½¿ç”¨" class="headerlink" title="åŸºæœ¬é…ç½®å’Œä½¿ç”¨"></a>åŸºæœ¬é…ç½®å’Œä½¿ç”¨</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/router.tsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; createRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;@tanstack/react-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; routeTree &#125; <span class="keyword">from</span> <span class="string">&#x27;./routeTree.gen&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createRouter</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123; </span><br><span class="line">        routeTree,</span><br><span class="line">        <span class="attr">scrollRestoration</span>: <span class="literal">true</span>, <span class="comment">// å¯ç”¨æ»šåŠ¨ä½ç½®æ¢å¤</span></span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> router</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æŠ€æœ¯å®ç°åŸç†"><a href="#æŠ€æœ¯å®ç°åŸç†" class="headerlink" title="æŠ€æœ¯å®ç°åŸç†"></a>æŠ€æœ¯å®ç°åŸç†</h2><h3 id="1-æµè§ˆå™¨-History-API-åŸºç¡€"><a href="#1-æµè§ˆå™¨-History-API-åŸºç¡€" class="headerlink" title="1. æµè§ˆå™¨ History API åŸºç¡€"></a>1. æµè§ˆå™¨ History API åŸºç¡€</h3><p>ç°ä»£æµè§ˆå™¨æä¾›äº†åŸç”Ÿçš„æ»šåŠ¨æ¢å¤æ§åˆ¶ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æµè§ˆå™¨åŸç”Ÿçš„ scrollRestoration</span></span><br><span class="line">history.<span class="property">scrollRestoration</span> = <span class="string">&#x27;auto&#x27;</span>    <span class="comment">// æµè§ˆå™¨è‡ªåŠ¨ç®¡ç†</span></span><br><span class="line">history.<span class="property">scrollRestoration</span> = <span class="string">&#x27;manual&#x27;</span>  <span class="comment">// æ‰‹åŠ¨ç®¡ç†</span></span><br></pre></td></tr></table></figure>

<p>TanStack Router é€šè¿‡è®¾ç½® <code>history.scrollRestoration = &#39;manual&#39;</code> æ¥æ¥ç®¡æ»šåŠ¨æ¢å¤çš„æ§åˆ¶æƒã€‚</p>
<h3 id="2-æ»šåŠ¨ä½ç½®çš„ä¿å­˜æœºåˆ¶"><a href="#2-æ»šåŠ¨ä½ç½®çš„ä¿å­˜æœºåˆ¶" class="headerlink" title="2. æ»šåŠ¨ä½ç½®çš„ä¿å­˜æœºåˆ¶"></a>2. æ»šåŠ¨ä½ç½®çš„ä¿å­˜æœºåˆ¶</h3><p>å½“è·¯ç”±å˜åŒ–æ—¶ï¼ŒTanStack Router ä¼šä¿å­˜å½“å‰æ»šåŠ¨ä½ç½®ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ»šåŠ¨ä½ç½®ä¿å­˜çš„æ¦‚å¿µå®ç°</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">saveScrollPosition</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> scrollData = &#123;</span><br><span class="line">    <span class="attr">x</span>: <span class="variable language_">window</span>.<span class="property">scrollX</span>,</span><br><span class="line">    <span class="attr">y</span>: <span class="variable language_">window</span>.<span class="property">scrollY</span>,</span><br><span class="line">    <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ä¿å­˜åˆ° sessionStorage</span></span><br><span class="line">  <span class="keyword">const</span> restoreKey = <span class="title function_">getKey</span>(router.<span class="property">state</span>.<span class="property">location</span>)</span><br><span class="line">  scrollRestorationCache.<span class="title function_">set</span>(restoreKey, &#123;</span><br><span class="line">    <span class="string">&#x27;window&#x27;</span>: scrollData</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-æ»šåŠ¨ä½ç½®çš„æ¢å¤æœºåˆ¶"><a href="#3-æ»šåŠ¨ä½ç½®çš„æ¢å¤æœºåˆ¶" class="headerlink" title="3. æ»šåŠ¨ä½ç½®çš„æ¢å¤æœºåˆ¶"></a>3. æ»šåŠ¨ä½ç½®çš„æ¢å¤æœºåˆ¶</h3><p>å½“è¿”å›åˆ°é¡µé¢æ—¶ï¼Œæ¢å¤æ»šåŠ¨ä½ç½®ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ»šåŠ¨ä½ç½®æ¢å¤çš„æ¦‚å¿µå®ç°</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">restoreScrollPosition</span> = (<span class="params">routeState</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (routeState.<span class="property">scrollPosition</span>) &#123;</span><br><span class="line">    <span class="comment">// ç­‰å¾…é¡µé¢æ¸²æŸ“å®Œæˆ</span></span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="title function_">scrollTo</span>(&#123;</span><br><span class="line">        <span class="attr">top</span>: routeState.<span class="property">scrollPosition</span>.<span class="property">y</span>,</span><br><span class="line">        <span class="attr">left</span>: routeState.<span class="property">scrollPosition</span>.<span class="property">x</span>,</span><br><span class="line">        <span class="attr">behavior</span>: <span class="string">&#x27;auto&#x27;</span> <span class="comment">// æˆ– &#x27;smooth&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-å…³é”®æ—¶æœºæ§åˆ¶"><a href="#4-å…³é”®æ—¶æœºæ§åˆ¶" class="headerlink" title="4. å…³é”®æ—¶æœºæ§åˆ¶"></a>4. å…³é”®æ—¶æœºæ§åˆ¶</h3><p><strong>ä¿å­˜æ—¶æœº</strong>ï¼š</p>
<ul>
<li>ç”¨æˆ·ç‚¹å‡»é“¾æ¥ç¦»å¼€é¡µé¢å‰</li>
<li>æµè§ˆå™¨å‰è¿›&#x2F;åé€€å¯¼èˆªå‰</li>
<li>è·¯ç”±å˜åŒ–è§¦å‘å‰</li>
</ul>
<p><strong>æ¢å¤æ—¶æœº</strong>ï¼š</p>
<ul>
<li>é¡µé¢ç»„ä»¶æŒ‚è½½å®Œæˆå</li>
<li>DOM æ¸²æŸ“å®Œæˆå</li>
<li>ä½¿ç”¨ <code>requestAnimationFrame</code> ç¡®ä¿å¸ƒå±€å®Œæˆ</li>
</ul>
<h2 id="æºç æ·±åº¦è§£æ"><a href="#æºç æ·±åº¦è§£æ" class="headerlink" title="æºç æ·±åº¦è§£æ"></a>æºç æ·±åº¦è§£æ</h2><p>åŸºäº TanStack Router å®˜æ–¹æºç çš„æ·±å…¥åˆ†æï¼Œä»¥ä¸‹æ˜¯ <code>scrollRestoration</code> åŠŸèƒ½çš„å…·ä½“å®ç°ï¼š</p>
<h3 id="1-createRouter-å‡½æ•°å…¥å£"><a href="#1-createRouter-å‡½æ•°å…¥å£" class="headerlink" title="1. createRouter å‡½æ•°å…¥å£"></a>1. createRouter å‡½æ•°å…¥å£</h3><p><strong>æ–‡ä»¶ä½ç½®</strong>ï¼š<code>packages/react-router/src/router.ts:80</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">createRouter</span>: <span class="title class_">CreateRouterFn</span> = <span class="function">(<span class="params">options</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Router</span>(options)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-scrollRestoration-é€‰é¡¹å®šä¹‰"><a href="#2-scrollRestoration-é€‰é¡¹å®šä¹‰" class="headerlink" title="2. scrollRestoration é€‰é¡¹å®šä¹‰"></a>2. scrollRestoration é€‰é¡¹å®šä¹‰</h3><p><strong>æ–‡ä»¶ä½ç½®</strong>ï¼š<code>packages/router-core/src/router.ts:390-414</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">RouterOptions</span>&lt;...&gt; &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * If `true`, scroll restoration will be enabled</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@default</span> <span class="variable">false</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">scrollRestoration</span>?: <span class="built_in">boolean</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * A function that will be called to get the key for the scroll restoration cache.</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@default</span> (location) =&gt; location.href</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">getScrollRestorationKey</span>?: <span class="function">(<span class="params"><span class="attr">location</span>: <span class="title class_">ParsedLocation</span></span>) =&gt;</span> <span class="built_in">string</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * The default behavior for scroll restoration.</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@default</span> &#x27;auto&#x27;</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">scrollRestorationBehavior</span>?: <span class="title class_">ScrollBehavior</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * An array of selectors that will be used to scroll to the top of the page in addition to `window`</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@default</span> [&#x27;window&#x27;]</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">scrollToTopSelectors</span>?: <span class="title class_">Array</span>&lt;<span class="built_in">string</span> | (<span class="function">() =&gt;</span> <span class="title class_">Element</span> | <span class="literal">null</span> | <span class="literal">undefined</span>)&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-Router-åˆå§‹åŒ–ä¸­çš„æ»šåŠ¨æ¢å¤è®¾ç½®"><a href="#3-Router-åˆå§‹åŒ–ä¸­çš„æ»šåŠ¨æ¢å¤è®¾ç½®" class="headerlink" title="3. Router åˆå§‹åŒ–ä¸­çš„æ»šåŠ¨æ¢å¤è®¾ç½®"></a>3. Router åˆå§‹åŒ–ä¸­çš„æ»šåŠ¨æ¢å¤è®¾ç½®</h3><p><strong>æ–‡ä»¶ä½ç½®</strong>ï¼š<code>packages/router-core/src/router.ts:924</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨ Router çš„ update æ–¹æ³•ä¸­</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">__store</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">__store</span> = <span class="keyword">new</span> <span class="title class_">Store</span>(<span class="title function_">getInitialRouterState</span>(<span class="variable language_">this</span>.<span class="property">latestLocation</span>), &#123;</span><br><span class="line">    <span class="attr">onUpdate</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setupScrollRestoration</span>(<span class="variable language_">this</span>) <span class="comment">// å…³é”®ï¼šåœ¨è¿™é‡Œåˆå§‹åŒ–æ»šåŠ¨æ¢å¤</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-setupScrollRestoration-æ ¸å¿ƒå®ç°"><a href="#4-setupScrollRestoration-æ ¸å¿ƒå®ç°" class="headerlink" title="4. setupScrollRestoration æ ¸å¿ƒå®ç°"></a>4. setupScrollRestoration æ ¸å¿ƒå®ç°</h3><p><strong>æ–‡ä»¶ä½ç½®</strong>ï¼š<code>packages/router-core/src/scroll-restoration.ts:209-353</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">setupScrollRestoration</span>(<span class="params"><span class="attr">router</span>: <span class="title class_">AnyRouter</span>, <span class="attr">force</span>?: <span class="built_in">boolean</span></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (scrollRestorationCache === <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> shouldScrollRestoration = force ?? router.<span class="property">options</span>.<span class="property">scrollRestoration</span> ?? <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (shouldScrollRestoration) &#123;</span><br><span class="line">    router.<span class="property">isScrollRestoring</span> = <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">document</span> === <span class="string">&#x27;undefined&#x27;</span> || router.<span class="property">isScrollRestorationSetup</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  router.<span class="property">isScrollRestorationSetup</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> getKey = router.<span class="property">options</span>.<span class="property">getScrollRestorationKey</span> || defaultGetScrollRestorationKey</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å…³é”®ï¼šè®¾ç½®æµè§ˆå™¨çš„æ»šåŠ¨æ¢å¤ä¸ºæ‰‹åŠ¨æ¨¡å¼</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">history</span>.<span class="property">scrollRestoration</span> = <span class="string">&#x27;manual&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç›‘å¬æ»šåŠ¨äº‹ä»¶å¹¶ç¼“å­˜æ»šåŠ¨ä½ç½®</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onScroll</span> = (<span class="params"><span class="attr">event</span>: <span class="title class_">Event</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (ignoreScroll || !router.<span class="property">isScrollRestoring</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> elementSelector = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (event.<span class="property">target</span> === <span class="variable language_">document</span> || event.<span class="property">target</span> === <span class="variable language_">window</span>) &#123;</span><br><span class="line">      elementSelector = <span class="string">&#x27;window&#x27;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> attrId = (event.<span class="property">target</span> <span class="keyword">as</span> <span class="title class_">Element</span>).<span class="title function_">getAttribute</span>(<span class="string">&#x27;data-scroll-restoration-id&#x27;</span>)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (attrId) &#123;</span><br><span class="line">        elementSelector = <span class="string">`[data-scroll-restoration-id=&quot;<span class="subst">$&#123;attrId&#125;</span>&quot;]`</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        elementSelector = <span class="title function_">getCssSelector</span>(event.<span class="property">target</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> restoreKey = <span class="title function_">getKey</span>(router.<span class="property">state</span>.<span class="property">location</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¿å­˜æ»šåŠ¨ä½ç½®åˆ° sessionStorage</span></span><br><span class="line">    scrollRestorationCache.<span class="title function_">set</span>(<span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> keyEntry = (state[restoreKey] = state[restoreKey] || &#123;&#125;)</span><br><span class="line">      <span class="keyword">const</span> elementEntry = (keyEntry[elementSelector] = keyEntry[elementSelector] || &#123;&#125;)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (elementSelector === <span class="string">&#x27;window&#x27;</span>) &#123;</span><br><span class="line">        elementEntry.<span class="property">scrollX</span> = <span class="variable language_">window</span>.<span class="property">scrollX</span> || <span class="number">0</span></span><br><span class="line">        elementEntry.<span class="property">scrollY</span> = <span class="variable language_">window</span>.<span class="property">scrollY</span> || <span class="number">0</span></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (elementSelector) &#123;</span><br><span class="line">        <span class="keyword">const</span> element = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(elementSelector)</span><br><span class="line">        <span class="keyword">if</span> (element) &#123;</span><br><span class="line">          elementEntry.<span class="property">scrollX</span> = element.<span class="property">scrollLeft</span> || <span class="number">0</span></span><br><span class="line">          elementEntry.<span class="property">scrollY</span> = element.<span class="property">scrollTop</span> || <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> state</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// èŠ‚æµå¤„ç†æ»šåŠ¨äº‹ä»¶ï¼Œæ¯ 100ms æœ€å¤šè§¦å‘ä¸€æ¬¡</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">document</span> !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;scroll&#x27;</span>, <span class="title function_">throttle</span>(onScroll, <span class="number">100</span>), <span class="literal">true</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç›‘å¬è·¯ç”±æ¸²æŸ“å®Œæˆäº‹ä»¶ï¼Œæ¢å¤æ»šåŠ¨ä½ç½®</span></span><br><span class="line">  router.<span class="title function_">subscribe</span>(<span class="string">&#x27;onRendered&#x27;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> cacheKey = <span class="title function_">getKey</span>(event.<span class="property">toLocation</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!router.<span class="property">resetNextScroll</span>) &#123;</span><br><span class="line">      router.<span class="property">resetNextScroll</span> = <span class="literal">true</span></span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">restoreScroll</span>(&#123;</span><br><span class="line">      storageKey,</span><br><span class="line">      <span class="attr">key</span>: cacheKey,</span><br><span class="line">      <span class="attr">behavior</span>: router.<span class="property">options</span>.<span class="property">scrollRestorationBehavior</span>,</span><br><span class="line">      <span class="attr">shouldScrollRestoration</span>: router.<span class="property">isScrollRestoring</span>,</span><br><span class="line">      <span class="attr">scrollToTopSelectors</span>: router.<span class="property">options</span>.<span class="property">scrollToTopSelectors</span>,</span><br><span class="line">      <span class="attr">location</span>: router.<span class="property">history</span>.<span class="property">location</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-restoreScroll-æ»šåŠ¨æ¢å¤å®ç°"><a href="#5-restoreScroll-æ»šåŠ¨æ¢å¤å®ç°" class="headerlink" title="5. restoreScroll æ»šåŠ¨æ¢å¤å®ç°"></a>5. restoreScroll æ»šåŠ¨æ¢å¤å®ç°</h3><p><strong>æ–‡ä»¶ä½ç½®</strong>ï¼š<code>packages/router-core/src/scroll-restoration.ts:104-207</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">restoreScroll</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">  storageKey,</span></span><br><span class="line"><span class="params">  key,</span></span><br><span class="line"><span class="params">  behavior,</span></span><br><span class="line"><span class="params">  shouldScrollRestoration,</span></span><br><span class="line"><span class="params">  scrollToTopSelectors,</span></span><br><span class="line"><span class="params">  location,</span></span><br><span class="line"><span class="params">&#125;: &#123;</span></span><br><span class="line"><span class="params">  storageKey: <span class="built_in">string</span></span></span><br><span class="line"><span class="params">  key?: <span class="built_in">string</span></span></span><br><span class="line"><span class="params">  behavior?: ScrollToOptions[<span class="string">&#x27;behavior&#x27;</span>]</span></span><br><span class="line"><span class="params">  shouldScrollRestoration?: <span class="built_in">boolean</span></span></span><br><span class="line"><span class="params">  scrollToTopSelectors?: <span class="built_in">Array</span>&lt;<span class="built_in">string</span> | (() =&gt; Element | <span class="literal">null</span> | <span class="literal">undefined</span>)&gt;</span></span><br><span class="line"><span class="params">  location?: HistoryLocation</span></span><br><span class="line"><span class="params">&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">byKey</span>: <span class="title class_">ScrollRestorationByKey</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    byKey = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">sessionStorage</span>.<span class="title function_">getItem</span>(storageKey) || <span class="string">&#x27;&#123;&#125;&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (<span class="attr">error</span>: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(error)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> resolvedKey = key || <span class="variable language_">window</span>.<span class="property">history</span>.<span class="property">state</span>?.<span class="property">key</span></span><br><span class="line">  <span class="keyword">const</span> elementEntries = byKey[resolvedKey]</span><br><span class="line"></span><br><span class="line">  ignoreScroll = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¼˜å…ˆæ¢å¤ç¼“å­˜çš„æ»šåŠ¨ä½ç½®</span></span><br><span class="line">  <span class="keyword">if</span> (shouldScrollRestoration &amp;&amp; elementEntries &amp;&amp; <span class="title class_">Object</span>.<span class="title function_">keys</span>(elementEntries).<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> elementSelector <span class="keyword">in</span> elementEntries) &#123;</span><br><span class="line">      <span class="keyword">const</span> entry = elementEntries[elementSelector]!</span><br><span class="line">      <span class="keyword">if</span> (elementSelector === <span class="string">&#x27;window&#x27;</span>) &#123;</span><br><span class="line">        <span class="variable language_">window</span>.<span class="title function_">scrollTo</span>(&#123;</span><br><span class="line">          <span class="attr">top</span>: entry.<span class="property">scrollY</span>,</span><br><span class="line">          <span class="attr">left</span>: entry.<span class="property">scrollX</span>,</span><br><span class="line">          behavior,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (elementSelector) &#123;</span><br><span class="line">        <span class="keyword">const</span> element = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(elementSelector)</span><br><span class="line">        <span class="keyword">if</span> (element) &#123;</span><br><span class="line">          element.<span class="property">scrollLeft</span> = entry.<span class="property">scrollX</span></span><br><span class="line">          element.<span class="property">scrollTop</span> = entry.<span class="property">scrollY</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¤„ç† hash æ»šåŠ¨</span></span><br><span class="line">  <span class="keyword">const</span> hash = (location ?? <span class="variable language_">window</span>.<span class="property">location</span>).<span class="property">hash</span>.<span class="title function_">split</span>(<span class="string">&#x27;#&#x27;</span>)[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (hash) &#123;</span><br><span class="line">    <span class="keyword">const</span> hashScrollIntoViewOptions = (<span class="variable language_">window</span>.<span class="property">history</span>.<span class="property">state</span> || &#123;&#125;).<span class="property">__hashScrollIntoViewOptions</span> ?? <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (hashScrollIntoViewOptions) &#123;</span><br><span class="line">      <span class="keyword">const</span> el = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(hash)</span><br><span class="line">      <span class="keyword">if</span> (el) &#123;</span><br><span class="line">        el.<span class="title function_">scrollIntoView</span>(hashScrollIntoViewOptions)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é»˜è®¤æ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨</span></span><br><span class="line">  [<span class="string">&#x27;window&#x27;</span>, ...(scrollToTopSelectors?.<span class="title function_">filter</span>(<span class="function">(<span class="params">d</span>) =&gt;</span> d !== <span class="string">&#x27;window&#x27;</span>) ?? [])].<span class="title function_">forEach</span>(<span class="function">(<span class="params">selector</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> element = selector === <span class="string">&#x27;window&#x27;</span> ? <span class="variable language_">window</span> : <span class="keyword">typeof</span> selector === <span class="string">&#x27;function&#x27;</span> ? <span class="title function_">selector</span>() : <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(selector)</span><br><span class="line">    <span class="keyword">if</span> (element) &#123;</span><br><span class="line">      element.<span class="title function_">scrollTo</span>(&#123;</span><br><span class="line">        <span class="attr">top</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">left</span>: <span class="number">0</span>,</span><br><span class="line">        behavior,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  ignoreScroll = <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-ç¼“å­˜ç³»ç»Ÿå®ç°"><a href="#6-ç¼“å­˜ç³»ç»Ÿå®ç°" class="headerlink" title="6. ç¼“å­˜ç³»ç»Ÿå®ç°"></a>6. ç¼“å­˜ç³»ç»Ÿå®ç°</h3><p><strong>æ–‡ä»¶ä½ç½®</strong>ï¼š<code>packages/router-core/src/scroll-restoration.ts:36-73</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å­˜å‚¨é”®å®šä¹‰</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> storageKey = <span class="string">&#x27;tsr-scroll-restoration-v1_3&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// èŠ‚æµå‡½æ•°å®ç°</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">throttle</span> = (<span class="params"><span class="attr">fn</span>: (...args: <span class="built_in">Array</span>&lt;<span class="built_in">any</span>&gt;) =&gt; <span class="built_in">void</span>, <span class="attr">wait</span>: <span class="built_in">number</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">timeout</span>: <span class="built_in">any</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">...<span class="attr">args</span>: <span class="title class_">Array</span>&lt;<span class="built_in">any</span>&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!timeout) &#123;</span><br><span class="line">      timeout = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">fn</span>(...args)</span><br><span class="line">        timeout = <span class="literal">null</span></span><br><span class="line">      &#125;, wait)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºæ»šåŠ¨æ¢å¤ç¼“å­˜</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createScrollRestorationCache</span>(<span class="params"></span>): <span class="title class_">ScrollRestorationCache</span> | <span class="literal">undefined</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> safeSessionStorage = <span class="title function_">getSafeSessionStorage</span>()</span><br><span class="line">  <span class="keyword">if</span> (!safeSessionStorage) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">undefined</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> persistedState = safeSessionStorage.<span class="title function_">getItem</span>(storageKey)</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">state</span>: <span class="title class_">ScrollRestorationByKey</span> = persistedState ? <span class="title class_">JSON</span>.<span class="title function_">parse</span>(persistedState) : &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    state,</span><br><span class="line">    <span class="attr">set</span>: <span class="function">(<span class="params">updater</span>) =&gt;</span> (</span><br><span class="line">      (state = <span class="title function_">functionalUpdate</span>(updater, state) || state),</span><br><span class="line">      safeSessionStorage.<span class="title function_">setItem</span>(storageKey, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(state))</span><br><span class="line">    ),</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> scrollRestorationCache = <span class="title function_">createScrollRestorationCache</span>()</span><br></pre></td></tr></table></figure>

<h3 id="6-æ•°æ®å­˜å‚¨ç»“æ„"><a href="#6-æ•°æ®å­˜å‚¨ç»“æ„" class="headerlink" title="6. æ•°æ®å­˜å‚¨ç»“æ„"></a>6. æ•°æ®å­˜å‚¨ç»“æ„</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sessionStorage ä¸­çš„æ•°æ®ç»“æ„</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;tsr-scroll-restoration-v1_3&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;/products&quot;</span>: &#123;          <span class="comment">// è·¯ç”±è·¯å¾„ä½œä¸º key</span></span><br><span class="line">      <span class="string">&quot;window&quot;</span>: &#123;           <span class="comment">// å…ƒç´ é€‰æ‹©å™¨</span></span><br><span class="line">        <span class="string">&quot;scrollX&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;scrollY&quot;</span>: <span class="number">1250</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;/products/123&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;window&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;scrollX&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;scrollY&quot;</span>: <span class="number">800</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ»šåŠ¨æ¢å¤å·¥ä½œæµç¨‹"><a href="#æ»šåŠ¨æ¢å¤å·¥ä½œæµç¨‹" class="headerlink" title="æ»šåŠ¨æ¢å¤å·¥ä½œæµç¨‹"></a>æ»šåŠ¨æ¢å¤å·¥ä½œæµç¨‹</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">    participant User as ç”¨æˆ·</span><br><span class="line">    participant Router as TanStack Router</span><br><span class="line">    participant Browser as æµè§ˆå™¨</span><br><span class="line">    participant Storage as SessionStorage</span><br><span class="line"></span><br><span class="line">    Note over Router: åˆå§‹åŒ–é˜¶æ®µ</span><br><span class="line">    Router-&gt;&gt;Browser: history.scrollRestoration = &#x27;manual&#x27;</span><br><span class="line">    Router-&gt;&gt;Browser: addEventListener(&#x27;scroll&#x27;, onScroll)</span><br><span class="line">    Router-&gt;&gt;Router: setupScrollRestoration()</span><br><span class="line"></span><br><span class="line">    Note over User: ç”¨æˆ·æµè§ˆå’Œå¯¼èˆª</span><br><span class="line">    User-&gt;&gt;Browser: æ»šåŠ¨é¡µé¢</span><br><span class="line">    Browser-&gt;&gt;Router: scroll event</span><br><span class="line">    Router-&gt;&gt;Storage: ä¿å­˜æ»šåŠ¨ä½ç½® &#123; x, y &#125;</span><br><span class="line">    </span><br><span class="line">    User-&gt;&gt;Router: ç‚¹å‡»é“¾æ¥å¯¼èˆª</span><br><span class="line">    Router-&gt;&gt;Storage: ä¿å­˜å½“å‰é¡µé¢æ»šåŠ¨ä½ç½®</span><br><span class="line">    Router-&gt;&gt;Browser: å¯¼èˆªåˆ°æ–°é¡µé¢</span><br><span class="line">    </span><br><span class="line">    Note over User: ç”¨æˆ·è¿”å›æ“ä½œ</span><br><span class="line">    User-&gt;&gt;Browser: ç‚¹å‡»åé€€æŒ‰é’®</span><br><span class="line">    Browser-&gt;&gt;Router: è·¯ç”±å˜åŒ–äº‹ä»¶</span><br><span class="line">    Router-&gt;&gt;Storage: è¯»å–ä¿å­˜çš„æ»šåŠ¨ä½ç½®</span><br><span class="line">    Router-&gt;&gt;Router: ç­‰å¾…é¡µé¢æ¸²æŸ“å®Œæˆ</span><br><span class="line">    Router-&gt;&gt;Browser: window.scrollTo(x, y)</span><br><span class="line">    Browser-&gt;&gt;User: é¡µé¢æ»šåŠ¨åˆ°ä¹‹å‰ä½ç½®</span><br></pre></td></tr></table></figure>

<h2 id="é«˜çº§ç‰¹æ€§"><a href="#é«˜çº§ç‰¹æ€§" class="headerlink" title="é«˜çº§ç‰¹æ€§"></a>é«˜çº§ç‰¹æ€§</h2><h3 id="1-å¤šå…ƒç´ æ»šåŠ¨æ”¯æŒ"><a href="#1-å¤šå…ƒç´ æ»šåŠ¨æ”¯æŒ" class="headerlink" title="1. å¤šå…ƒç´ æ»šåŠ¨æ”¯æŒ"></a>1. å¤šå…ƒç´ æ»šåŠ¨æ”¯æŒ</h3><p>TanStack Router ä¸ä»…æ”¯æŒ window çº§åˆ«çš„æ»šåŠ¨ï¼Œè¿˜æ”¯æŒé¡µé¢å†…æ»šåŠ¨å®¹å™¨ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ”¯æŒå¤šä¸ªæ»šåŠ¨å…ƒç´ </span></span><br><span class="line"><span class="keyword">const</span> elementSelector = event.<span class="property">target</span> === <span class="variable language_">window</span> </span><br><span class="line">  ? <span class="string">&#x27;window&#x27;</span> </span><br><span class="line">  : <span class="title function_">getCssSelector</span>(event.<span class="property">target</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸ºç‰¹å®šå…ƒç´ è®¾ç½®æ»šåŠ¨æ¢å¤ ID</span></span><br><span class="line">&lt;div data-scroll-restoration-id=<span class="string">&quot;product-list&quot;</span> className=<span class="string">&quot;overflow-auto&quot;</span>&gt;</span><br><span class="line">  &#123;<span class="comment">/* æ»šåŠ¨å†…å®¹ */</span>&#125;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-è‡ªå®šä¹‰æ»šåŠ¨æ¢å¤é”®"><a href="#2-è‡ªå®šä¹‰æ»šåŠ¨æ¢å¤é”®" class="headerlink" title="2. è‡ªå®šä¹‰æ»šåŠ¨æ¢å¤é”®"></a>2. è‡ªå®šä¹‰æ»šåŠ¨æ¢å¤é”®</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  routeTree,</span><br><span class="line">  <span class="attr">scrollRestoration</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">getScrollRestorationKey</span>: <span class="function">(<span class="params">location</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// è‡ªå®šä¹‰ç¼“å­˜é”®ç”Ÿæˆç­–ç•¥</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;location.pathname&#125;</span><span class="subst">$&#123;location.search&#125;</span>`</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="3-æ»šåŠ¨è¡Œä¸ºé…ç½®"><a href="#3-æ»šåŠ¨è¡Œä¸ºé…ç½®" class="headerlink" title="3. æ»šåŠ¨è¡Œä¸ºé…ç½®"></a>3. æ»šåŠ¨è¡Œä¸ºé…ç½®</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  routeTree,</span><br><span class="line">  <span class="attr">scrollRestoration</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">scrollRestorationBehavior</span>: <span class="string">&#x27;smooth&#x27;</span>, <span class="comment">// &#x27;auto&#x27; | &#x27;smooth&#x27;</span></span><br><span class="line">  <span class="attr">scrollToTopSelectors</span>: [<span class="string">&#x27;window&#x27;</span>, <span class="string">&#x27;.main-content&#x27;</span>]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="æ€§èƒ½ä¼˜åŒ–æœºåˆ¶"><a href="#æ€§èƒ½ä¼˜åŒ–æœºåˆ¶" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–æœºåˆ¶"></a>æ€§èƒ½ä¼˜åŒ–æœºåˆ¶</h2><h3 id="1-äº‹ä»¶é˜²æŠ–"><a href="#1-äº‹ä»¶é˜²æŠ–" class="headerlink" title="1. äº‹ä»¶é˜²æŠ–"></a>1. äº‹ä»¶é˜²æŠ–</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨èŠ‚æµå‡½æ•°ï¼Œæ¯ 100ms æœ€å¤šè§¦å‘ä¸€æ¬¡ä¿å­˜</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;scroll&#x27;</span>, <span class="title function_">throttle</span>(onScroll, <span class="number">100</span>), <span class="literal">true</span>)</span><br></pre></td></tr></table></figure>

<h3 id="2-æ™ºèƒ½å¿½ç•¥æœºåˆ¶"><a href="#2-æ™ºèƒ½å¿½ç•¥æœºåˆ¶" class="headerlink" title="2. æ™ºèƒ½å¿½ç•¥æœºåˆ¶"></a>2. æ™ºèƒ½å¿½ç•¥æœºåˆ¶</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ignoreScroll = <span class="literal">false</span> <span class="comment">// é˜²æ­¢æ¢å¤æ»šåŠ¨æ—¶è§¦å‘ä¿å­˜</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">restoreScroll</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  ignoreScroll = <span class="literal">true</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">scrollTo</span>(x, y)</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    ignoreScroll = <span class="literal">false</span></span><br><span class="line">  &#125;, <span class="number">100</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-æ¸²æŸ“å®Œæˆæ£€æµ‹"><a href="#3-æ¸²æŸ“å®Œæˆæ£€æµ‹" class="headerlink" title="3. æ¸²æŸ“å®Œæˆæ£€æµ‹"></a>3. æ¸²æŸ“å®Œæˆæ£€æµ‹</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨ requestAnimationFrame ç¡®ä¿ DOM æ¸²æŸ“å®Œæˆ</span></span><br><span class="line"><span class="title function_">requestAnimationFrame</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">scrollTo</span>(&#123;</span><br><span class="line">    <span class="attr">top</span>: savedPosition.<span class="property">y</span>,</span><br><span class="line">    <span class="attr">left</span>: savedPosition.<span class="property">x</span>,</span><br><span class="line">    <span class="attr">behavior</span>: <span class="string">&#x27;auto&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="è¾¹ç•Œæƒ…å†µå¤„ç†"><a href="#è¾¹ç•Œæƒ…å†µå¤„ç†" class="headerlink" title="è¾¹ç•Œæƒ…å†µå¤„ç†"></a>è¾¹ç•Œæƒ…å†µå¤„ç†</h2><h3 id="1-é¡µé¢é«˜åº¦å˜åŒ–"><a href="#1-é¡µé¢é«˜åº¦å˜åŒ–" class="headerlink" title="1. é¡µé¢é«˜åº¦å˜åŒ–"></a>1. é¡µé¢é«˜åº¦å˜åŒ–</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¤„ç†åŠ¨æ€å†…å®¹åŠ è½½å¯¼è‡´çš„é¡µé¢é«˜åº¦å˜åŒ–</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">restoreWithRetry</span> = (<span class="params">targetY</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> attempts = <span class="number">0</span></span><br><span class="line">  <span class="keyword">const</span> maxAttempts = <span class="number">10</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">tryRestore</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> currentHeight = <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">scrollHeight</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (currentHeight &gt;= targetY || attempts &gt;= maxAttempts) &#123;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="title function_">scrollTo</span>(<span class="number">0</span>, <span class="title class_">Math</span>.<span class="title function_">min</span>(targetY, currentHeight))</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    attempts++</span><br><span class="line">    <span class="built_in">setTimeout</span>(tryRestore, <span class="number">100</span>) <span class="comment">// å»¶è¿Ÿé‡è¯•</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">tryRestore</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-Hash-é“¾æ¥å¤„ç†"><a href="#2-Hash-é“¾æ¥å¤„ç†" class="headerlink" title="2. Hash é“¾æ¥å¤„ç†"></a>2. Hash é“¾æ¥å¤„ç†</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼˜å…ˆå¤„ç† hash æ»šåŠ¨</span></span><br><span class="line"><span class="keyword">const</span> hash = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">hash</span>.<span class="title function_">split</span>(<span class="string">&#x27;#&#x27;</span>)[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">if</span> (hash) &#123;</span><br><span class="line">  <span class="keyword">const</span> element = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(hash)</span><br><span class="line">  <span class="keyword">if</span> (element) &#123;</span><br><span class="line">    element.<span class="title function_">scrollIntoView</span>()</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-é”™è¯¯å¤„ç†"><a href="#3-é”™è¯¯å¤„ç†" class="headerlink" title="3. é”™è¯¯å¤„ç†"></a>3. é”™è¯¯å¤„ç†</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> cachedData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">sessionStorage</span>.<span class="title function_">getItem</span>(storageKey) || <span class="string">&#x27;&#123;&#125;&#x27;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Failed to parse scroll restoration data:&#x27;</span>, error)</span><br><span class="line">  <span class="comment">// é™çº§åˆ°é»˜è®¤è¡Œä¸º</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">scrollTo</span>(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>TanStack Router çš„ <code>scrollRestoration</code> åŠŸèƒ½é€šè¿‡ä»¥ä¸‹å…³é”®æŠ€æœ¯å®ç°äº†ç²¾ç¡®çš„æ»šåŠ¨ä½ç½®æ¢å¤ï¼š</p>
<ol>
<li><strong>æµè§ˆå™¨ API æ¥ç®¡</strong>ï¼šé€šè¿‡ <code>history.scrollRestoration = &#39;manual&#39;</code> æ¥ç®¡æµè§ˆå™¨åŸç”Ÿè¡Œä¸º</li>
<li><strong>äº‹ä»¶ç›‘å¬æœºåˆ¶</strong>ï¼šç›‘å¬ scroll äº‹ä»¶ï¼Œå®æ—¶ä¿å­˜æ»šåŠ¨ä½ç½®</li>
<li><strong>SessionStorage æŒä¹…åŒ–</strong>ï¼šä½¿ç”¨ sessionStorage è·¨é¡µé¢ä¿å­˜æ»šåŠ¨æ•°æ®</li>
<li><strong>æ™ºèƒ½æ¢å¤ç­–ç•¥</strong>ï¼šç»“åˆ requestAnimationFrame å’Œé‡è¯•æœºåˆ¶ç¡®ä¿å‡†ç¡®æ¢å¤</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šé€šè¿‡é˜²æŠ–ã€å¿½ç•¥æœºåˆ¶ç­‰ä¼˜åŒ–æ€§èƒ½</li>
<li><strong>å¤šå…ƒç´ æ”¯æŒ</strong>ï¼šä¸ä»…æ”¯æŒ window æ»šåŠ¨ï¼Œè¿˜æ”¯æŒé¡µé¢å†…æ»šåŠ¨å®¹å™¨</li>
</ol>
<p>è¿™ä¸ªåŠŸèƒ½çœ‹ä¼¼ç®€å•ï¼Œä½†å…¶å®ç°æ¶‰åŠäº†æ·±åº¦çš„æµè§ˆå™¨ API ç†è§£ã€äº‹ä»¶å¤„ç†ä¼˜åŒ–ã€æ•°æ®æŒä¹…åŒ–ç­–ç•¥ç­‰å¤šä¸ªæŠ€æœ¯å±‚é¢ã€‚é€šè¿‡æºç åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° TanStack Router å›¢é˜Ÿåœ¨ç”¨æˆ·ä½“éªŒä¼˜åŒ–ä¸Šçš„ç»†è‡´è€ƒè™‘å’ŒæŠ€æœ¯æ·±åº¦ã€‚</p>
<p>å¯¹äºç°ä»£ SPA åº”ç”¨æ¥è¯´ï¼Œå¯ç”¨ <code>scrollRestoration: true</code> æ˜¯ä¸€ä¸ªç®€å•è€Œæœ‰æ•ˆçš„ç”¨æˆ·ä½“éªŒæå‡æ–¹æ¡ˆã€‚å®ƒä¸ä»…æŠ€æœ¯å®ç°ç²¾å·§ï¼Œæ›´é‡è¦çš„æ˜¯çœŸæ­£è§£å†³äº†ç”¨æˆ·åœ¨åº”ç”¨ä¸­å¯¼èˆªæ—¶çš„ç—›ç‚¹é—®é¢˜ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.baduncle.top/2025/08/06/tanstack-router-scroll-restoration-analysis/" data-id="cme0spedr0000fwq9b545cpd1" data-title="TanStack Router scrollRestoration æ·±åº¦è§£æï¼šä»æºç åˆ°å®ç°åŸç†" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/browser-api/" rel="tag">browser-api</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/event-throttling/" rel="tag">event-throttling</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/history-api/" rel="tag">history-api</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/performance-optimization/" rel="tag">performance-optimization</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/react/" rel="tag">react</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/scroll-restoration/" rel="tag">scroll-restoration</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/session-storage/" rel="tag">session-storage</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/source-code-analysis/" rel="tag">source-code-analysis</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spa/" rel="tag">spa</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tanstack-router/" rel="tag">tanstack-router</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/typescript/" rel="tag">typescript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/user-experience/" rel="tag">user-experience</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2025/08/06/javascript-typescript-function-syntax-guide-for-java-developers/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          JavaScript/TypeScript å‡½æ•°è¯­æ³•å®Œå…¨æŒ‡å—ï¼šä» Java å¼€å‘è€…è§†è§’ç†è§£ç°ä»£ JS å‡½æ•°
        
      </div>
    </a>
  
  
    <a href="/2025/08/06/typescript-typeof-returntype-explained/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">æ·±å…¥ç†è§£ TypeScript çš„ typeof å’Œ ReturnTypeï¼šä» Java å¼€å‘è€…è§†è§’</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Programming/">Programming</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Programming/" rel="tag">Programming</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ReturnType/" rel="tag">ReturnType</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tutorial/" rel="tag">Tutorial</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TypeScript/" rel="tag">TypeScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/arrow-functions/" rel="tag">arrow-functions</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/async-await/" rel="tag">async-await</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/browser-api/" rel="tag">browser-api</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/declare-module/" rel="tag">declare-module</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/destructuring/" rel="tag">destructuring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/event-throttling/" rel="tag">event-throttling</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/function-types/" rel="tag">function-types</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/generics/" rel="tag">generics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/history-api/" rel="tag">history-api</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/intersection-types/" rel="tag">intersection-types</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java-to-javascript/" rel="tag">java-to-javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/module-system/" rel="tag">module-system</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/operators/" rel="tag">operators</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/optional-chaining/" rel="tag">optional-chaining</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/optional-parameters/" rel="tag">optional-parameters</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/performance-optimization/" rel="tag">performance-optimization</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/" rel="tag">react</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scroll-restoration/" rel="tag">scroll-restoration</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/session-storage/" rel="tag">session-storage</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/source-code-analysis/" rel="tag">source-code-analysis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spa/" rel="tag">spa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spread-operator/" rel="tag">spread-operator</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/symbols/" rel="tag">symbols</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/syntax/" rel="tag">syntax</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tanstack-router/" rel="tag">tanstack-router</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/template-literals/" rel="tag">template-literals</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/this-binding/" rel="tag">this-binding</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/type-annotations/" rel="tag">type-annotations</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/type-safety/" rel="tag">type-safety</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/typeof/" rel="tag">typeof</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/typescript/" rel="tag">typescript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/union-types/" rel="tag">union-types</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/user-experience/" rel="tag">user-experience</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/utility-types/" rel="tag">utility-types</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/JavaScript/" style="font-size: 20px;">JavaScript</a> <a href="/tags/Programming/" style="font-size: 20px;">Programming</a> <a href="/tags/ReturnType/" style="font-size: 10px;">ReturnType</a> <a href="/tags/Tutorial/" style="font-size: 20px;">Tutorial</a> <a href="/tags/TypeScript/" style="font-size: 20px;">TypeScript</a> <a href="/tags/arrow-functions/" style="font-size: 20px;">arrow-functions</a> <a href="/tags/async-await/" style="font-size: 10px;">async-await</a> <a href="/tags/browser-api/" style="font-size: 10px;">browser-api</a> <a href="/tags/declare-module/" style="font-size: 10px;">declare-module</a> <a href="/tags/destructuring/" style="font-size: 10px;">destructuring</a> <a href="/tags/event-throttling/" style="font-size: 10px;">event-throttling</a> <a href="/tags/function-types/" style="font-size: 10px;">function-types</a> <a href="/tags/generics/" style="font-size: 10px;">generics</a> <a href="/tags/history-api/" style="font-size: 10px;">history-api</a> <a href="/tags/intersection-types/" style="font-size: 10px;">intersection-types</a> <a href="/tags/java-to-javascript/" style="font-size: 10px;">java-to-javascript</a> <a href="/tags/javascript/" style="font-size: 10px;">javascript</a> <a href="/tags/module-system/" style="font-size: 10px;">module-system</a> <a href="/tags/operators/" style="font-size: 10px;">operators</a> <a href="/tags/optional-chaining/" style="font-size: 10px;">optional-chaining</a> <a href="/tags/optional-parameters/" style="font-size: 10px;">optional-parameters</a> <a href="/tags/performance-optimization/" style="font-size: 10px;">performance-optimization</a> <a href="/tags/react/" style="font-size: 10px;">react</a> <a href="/tags/scroll-restoration/" style="font-size: 10px;">scroll-restoration</a> <a href="/tags/session-storage/" style="font-size: 10px;">session-storage</a> <a href="/tags/source-code-analysis/" style="font-size: 10px;">source-code-analysis</a> <a href="/tags/spa/" style="font-size: 10px;">spa</a> <a href="/tags/spread-operator/" style="font-size: 10px;">spread-operator</a> <a href="/tags/symbols/" style="font-size: 10px;">symbols</a> <a href="/tags/syntax/" style="font-size: 10px;">syntax</a> <a href="/tags/tanstack-router/" style="font-size: 10px;">tanstack-router</a> <a href="/tags/template-literals/" style="font-size: 10px;">template-literals</a> <a href="/tags/this-binding/" style="font-size: 10px;">this-binding</a> <a href="/tags/type-annotations/" style="font-size: 10px;">type-annotations</a> <a href="/tags/type-safety/" style="font-size: 10px;">type-safety</a> <a href="/tags/typeof/" style="font-size: 10px;">typeof</a> <a href="/tags/typescript/" style="font-size: 20px;">typescript</a> <a href="/tags/union-types/" style="font-size: 10px;">union-types</a> <a href="/tags/user-experience/" style="font-size: 10px;">user-experience</a> <a href="/tags/utility-types/" style="font-size: 10px;">utility-types</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/08/">August 2025</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/08/07/typescript-javascript-symbols-guide/">TypeScript/JavaScript æ ‡ç‚¹ç¬¦å·å®Œå…¨æŒ‡å—ï¼šä»åŸºç¡€åˆ°é«˜çº§ç”¨æ³•</a>
          </li>
        
          <li>
            <a href="/2025/08/06/javascript-typescript-function-syntax-guide-for-java-developers/">JavaScript/TypeScript å‡½æ•°è¯­æ³•å®Œå…¨æŒ‡å—ï¼šä» Java å¼€å‘è€…è§†è§’ç†è§£ç°ä»£ JS å‡½æ•°</a>
          </li>
        
          <li>
            <a href="/2025/08/06/tanstack-router-scroll-restoration-analysis/">TanStack Router scrollRestoration æ·±åº¦è§£æï¼šä»æºç åˆ°å®ç°åŸç†</a>
          </li>
        
          <li>
            <a href="/2025/08/06/typescript-typeof-returntype-explained/">æ·±å…¥ç†è§£ TypeScript çš„ typeof å’Œ ReturnTypeï¼šä» Java å¼€å‘è€…è§†è§’</a>
          </li>
        
          <li>
            <a href="/2025/08/06/typescript-module-system-guide/">TypeScript æ¨¡å—ç³»ç»Ÿå®Œå…¨æŒ‡å—ï¼šä» Java å¼€å‘è€…è§†è§’ç†è§£ declare module</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 Baduncle<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>